{% extends 'base.html' %}

{% block content %}

<div class="row mt-3">
    <div class="col-lg-8 mb-4">
        <div class="card shadow border-0">
            <div class="card-body p-0">
                <div class="ratio ratio-16x9 bg-dark">
                    <iframe id="pantalla-video" src="" allowfullscreen></iframe>
                </div>
            </div>
            <div class="card-footer bg-white py-3">
                <h2 id="titulo-video" class="h4 mb-0">Selecciona una clase para comenzar</h2>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <span class="fw-bold">Contenido del Curso</span>
                <span class="badge bg-secondary">{{ curso.videos|length }} Clases</span>
            </div>
            
            <div class="list-group list-group-flush" style="max-height: 500px; overflow-y: auto;">
                {% for video in curso.videos %}
                    <button 
                        class="list-group-item list-group-item-action d-flex align-items-center gap-3 py-3" 
                        onclick="cambiarVideo('{{ video.url_video }}', '{{ video.titulo }}')"
                    >
                        <i class="bi bi-play-circle text-primary fs-4"></i>
                        <div>
                            <small class="text-muted fw-bold">Clase {{ loop.index }}</small>
                            <div class="mb-0">{{ video.titulo }}</div>
                        </div>
                    </button>
                {% else %}
                    <div class="p-3 text-muted text-center">Aún no hay videos cargados.</div>
                {% endfor %}
            </div>
        </div>
        
        <div class="mt-3 text-center">
            <a href="/categoria/{{ curso.categoria_id }}" class="text-decoration-none text-secondary">
                <i class="bi bi-arrow-left"></i> Volver a la categoría
            </a>
        </div>
    </div>
</div>

<script>
    function cambiarVideo(url, titulo) {
        document.getElementById('pantalla-video').src = url;
        document.getElementById('titulo-video').innerText = titulo;
        
        // Auto-play (truco opcional): Agregamos ?autoplay=1 al link
        // Nota: Algunos navegadores bloquean el autoplay por sonido
    }

    // Opcional: Cargar el primer video automáticamente al abrir la página
    document.addEventListener("DOMContentLoaded", function() {
        // Verificamos si hay videos en la lista
        {% if curso.videos %}
            // Tomamos los datos del primer video
            cambiarVideo('{{ curso.videos[0].url_video }}', '{{ curso.videos[0].titulo }}');
        {% endif %}
    });
</script>

{% endblock %}